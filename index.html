<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Odoo Partner Qualification 360¬∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <style>
    @media print { .no-print { display:none !important; } }
    tr.red-flag, .red-flag { background-color:#fee2e2; }
    body { padding-bottom: 120px; }
    .badge { transition: all 0.3s ease; }
    .radio-option { transition: all 0.2s; }
    .radio-option:hover { background-color: #f3f4f6; }
    .radio-option input:checked ~ span { font-weight: 600; color: #714B67; }
  </style>
</head>
<body class="bg-gray-50 text-slate-800">
  <header class="bg-[#714B67] text-white p-4 shadow sticky top-0 z-20">
    <div class="max-w-7xl mx-auto">
      <div class="flex items-center gap-3 flex-wrap justify-between">
        <h1 class="text-lg md:text-xl font-semibold" id="mainTitle">Odoo Partner Qualification 360¬∞</h1>
        <div class="flex items-center gap-3 text-xs md:text-sm flex-wrap">
          <button id="langToggle" class="px-3 py-1 bg-white/20 rounded hover:bg-white/30 transition font-medium">
            üåê <span id="langText">ES</span>
          </button>
          <div class="flex items-center gap-1">
            <span id="labelType">Tipo:</span>
            <span id="badgeType" class="badge px-2 py-0.5 rounded bg-white/20">‚Äî</span>
          </div>
          <div class="flex items-center gap-1">
            <span id="labelTotal">Total:</span>
            <span id="badgeScore" class="badge px-2 py-0.5 rounded bg-white/20">‚Äî</span>
          </div>
          <div class="flex items-center gap-1">
            <span>üö©</span>
            <span id="badgeRF" class="badge px-2 py-0.5 rounded bg-white/20">0</span>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="max-w-7xl mx-auto px-4 py-6">
    <section class="bg-white p-4 rounded-2xl shadow">
      <div class="grid sm:grid-cols-2 lg:grid-cols-4 gap-4">
        <div>
          <label class="text-sm font-medium block" id="labelPartnerName">Partner Name *</label>
          <input id="partnerName" class="w-full border rounded px-3 py-2 mt-1 focus:ring-2 focus:ring-[#714B67]" placeholder="e.g. ERP Mexico" />
        </div>
        <div>
          <label class="text-sm font-medium block" id="labelPartnerManager">Partner Manager *</label>
          <input id="partnerManager" class="w-full border rounded px-3 py-2 mt-1 focus:ring-2 focus:ring-[#714B67]" placeholder="e.g. Alnu" />
        </div>
        <div>
          <label class="text-sm font-medium block" id="labelRoleMode">Role Filter</label>
          <select id="roleMode" class="w-full border rounded px-3 py-2 mt-1 focus:ring-2 focus:ring-[#714B67]">
            <option value="all" id="optAll">View All</option>
            <option value="Recruiter" id="optRecruiter">Recruiter + Shared</option>
            <option value="PM" id="optPM">PM + Shared</option>
          </select>
        </div>
        <div>
          <label class="text-sm font-medium block" id="labelSearch">Quick Search</label>
          <input id="searchBox" class="w-full border rounded px-3 py-2 mt-1 focus:ring-2 focus:ring-[#714B67]" placeholder="Filter..." />
        </div>
      </div>
      <p class="mt-3 text-xs text-gray-500 bg-blue-50 p-2 rounded">
        üí° <strong id="noteLabel">Note:</strong> <span id="noteText">Total calculated with internal weights √ó Score 1‚Äì5.</span>
      </p>
    </section>

    <section id="resultsSummary" class="mt-6 bg-gradient-to-r from-[#714B67] to-[#8a5d7f] text-white p-6 rounded-2xl shadow-lg hidden">
      <div class="grid md:grid-cols-2 gap-6">
        <div>
          <h3 class="text-2xl font-bold mb-2" id="resultsTitle">Results</h3>
          <div class="space-y-2">
            <div class="flex items-center gap-2">
              <span class="text-3xl font-bold" id="displayScore">‚Äî</span>
              <span class="text-lg opacity-90">/5.0</span>
            </div>
            <div class="text-xl font-semibold" id="displayCategory">‚Äî</div>
            <div class="text-lg opacity-90" id="displaySubcategory">‚Äî</div>
          </div>
        </div>
        <div>
          <h4 class="font-semibold mb-2 text-lg" id="actionPlanTitle">Action Plan</h4>
          <ul id="actionPlanList" class="space-y-1 text-sm opacity-90"></ul>
        </div>
      </div>
    </section>

    <section id="formRoot" class="mt-6 space-y-6"></section>
  </main>

  <footer class="fixed bottom-0 left-0 right-0 bg-white border-t shadow-lg z-20 no-print">
    <div class="max-w-7xl mx-auto px-4 py-3">
      <div class="flex flex-col md:flex-row justify-between items-center gap-3">
        <div class="text-sm text-gray-700 font-medium">
          <span class="inline-block mr-3"><strong id="footerLabelTotal">Total:</strong> <span id="footerScore" class="text-[#714B67]">‚Äî</span></span>
          <span class="inline-block mr-3"><strong id="footerLabelType">Type:</strong> <span id="footerType">‚Äî</span></span>
          <span class="inline-block"><strong>üö©</strong> <span id="footerRF" class="text-red-600">0</span></span>
        </div>
        <div class="flex gap-2">
          <button id="btnClear" class="px-4 py-2 border rounded hover:bg-gray-50 text-sm font-medium">
            üóëÔ∏è <span id="btnClearText">Clear</span>
          </button>
          <button id="btnXLSX" class="px-4 py-2 bg-green-50 text-green-800 rounded hover:bg-green-100 text-sm font-medium">üìä Excel</button>
          <button id="btnPDF" class="px-4 py-2 bg-[#714B67] text-white rounded hover:bg-[#5a3a52] text-sm font-medium">üìÑ PDF</button>
        </div>
      </div>
    </div>
  </footer>

  <section id="pdfArea" class="hidden p-6">
    <h2 class="text-2xl font-bold text-[#714B67] mb-2">Odoo Partner Qualification 360¬∞</h2>
    <p class="text-sm text-gray-600 mb-4"><span id="pdfGenerated">Generated:</span> <span id="pdfDate"></span></p>
    <div class="grid grid-cols-2 gap-3 text-sm mb-4 bg-gray-50 p-3 rounded">
      <div><strong>Partner:</strong> <span id="pdfPartner"></span></div>
      <div><strong>PM:</strong> <span id="pdfPM"></span></div>
      <div><strong>Total:</strong> <span id="pdfScore"></span></div>
      <div><strong>Category:</strong> <span id="pdfType"></span></div>
      <div><strong>Subcategory:</strong> <span id="pdfSubcat"></span></div>
      <div><strong>Red Flags:</strong> <span id="pdfRF"></span></div>
    </div>
    <div class="mb-4 bg-blue-50 p-3 rounded">
      <h3 class="font-semibold mb-2">Action Plan:</h3>
      <div id="pdfActionPlan" class="text-sm"></div>
    </div>
    <h3 class="font-semibold mb-2">Responses</h3>
    <table class="w-full text-xs border-collapse">
      <thead class="bg-[#714B67] text-white">
        <tr>
          <th class="p-2 border">Block</th>
          <th class="p-2 border">Role</th>
          <th class="p-2 border">Question</th>
          <th class="p-2 border">Weight</th>
          <th class="p-2 border">Score</th>
          <th class="p-2 border">Comments</th>
        </tr>
      </thead>
      <tbody id="pdfBody"></tbody>
    </table>
  </section>

  <script>
const LANG={es:{mainTitle:'Odoo Partner Qualification 360¬∞ ‚Äî Evaluaci√≥n PR/PM',labelType:'Tipo:',labelTotal:'Total:',labelPartnerName:'Nombre del Partner *',labelPartnerManager:'Partner Manager *',labelRoleMode:'Filtro por Rol',labelSearch:'B√∫squeda R√°pida',optAll:'Ver Todo',optRecruiter:'Solo Recruiter + Compartidas',optPM:'Solo PM + Compartidas',noteLabel:'Nota:',noteText:'El total se calcula con pesos internos √ó Score 1‚Äì5.',resultsTitle:'Resultados de Clasificaci√≥n',actionPlanTitle:'Plan de Acci√≥n Recomendado',footerLabelTotal:'Total:',footerLabelType:'Tipo:',btnClearText:'Limpiar',confirmClear:'¬øSeguro que deseas limpiar todo?',alertNoData:'Completa Partner Name y Partner Manager.',alertNoResponses:'No hay respuestas para exportar.',pdfGenerated:'Generado:',commentsPlaceholder:'Comentarios opcionales...'},en:{mainTitle:'Odoo Partner Qualification 360¬∞ ‚Äî PR/PM Assessment',labelType:'Type:',labelTotal:'Total:',labelPartnerName:'Partner Name *',labelPartnerManager:'Partner Manager *',labelRoleMode:'Role Filter',labelSearch:'Quick Search',optAll:'View All',optRecruiter:'Recruiter + Shared Only',optPM:'PM + Shared Only',noteLabel:'Note:',noteText:'Total calculated with internal weights √ó Score 1‚Äì5.',resultsTitle:'Classification Results',actionPlanTitle:'Recommended Action Plan',footerLabelTotal:'Total:',footerLabelType:'Type:',btnClearText:'Clear',confirmClear:'Are you sure you want to clear everything?',alertNoData:'Please complete Partner Name and Partner Manager.',alertNoResponses:'No responses to export.',pdfGenerated:'Generated:',commentsPlaceholder:'Add optional comments...'}};

const QUESTIONS=[['PR ‚Äì Quick Profiling','Recruiter','¬øPor qu√© quieren ser Partner de Odoo?','Why do they want to become an Odoo Partner?',['Curiosidad / Exploraci√≥n','Just curious / Exploration'],['Oportunidad comercial b√°sica','Basic commercial opportunity'],['Diversificar portafolio','Diversify portfolio'],['Estrategia con roadmap parcial','Strategy with partial roadmap'],['Plan estrat√©gico documentado','Documented strategic plan'],1.8],['PR ‚Äì Quick Profiling','Recruiter','¬øTienen equipo dedicado o solo el fundador?','Do they have a dedicated team or just the founder?',['Solo el fundador','Just the founder'],['Fundador + 1 ocasional','Founder + 1 occasional'],['1-2 part-time','1-2 part-time'],['2 full-time','2 full-time'],['3+ full-time','3+ full-time'],1.8],['PR ‚Äì Quick Profiling','Recruiter','¬øHan considerado invertir en PLO/Success Pack/Certificaci√≥n?','Have they considered investing in PLO/Success Pack/Certification?',['No han considerado','Not considered'],['Conocen pero sin presupuesto','Aware but no budget'],['En an√°lisis activo','Under active analysis'],['Presupuesto aprobado','Budget approved'],['Ya invirtieron','Already invested'],1.8],['PR ‚Äì Quick Profiling','Recruiter','¬øExperiencia previa en ERPs o software?','Previous experience in ERPs or software?',['Ninguna experiencia','No experience'],['Solo software b√°sico','Only basic software'],['Otros ERPs (SAP, Oracle)','Other ERPs (SAP, Oracle)'],['ERPs open source','Open source ERPs'],['Experiencia con Odoo','Experience with Odoo'],1.8],['PR ‚Äì Quick Profiling','Recruiter','¬øD√≥nde ven a Odoo en 1-2 a√±os?','Where do they see Odoo in 1-2 years?',['Incierto / No definido','Uncertain / Not defined'],['L√≠nea secundaria','Secondary product line'],['Complemento importante','Important complement'],['Producto core','One of core products'],['Producto principal','The main product'],1.8],['PR ‚Äì Quick Profiling','Recruiter','¬øQui√©n toma la decisi√≥n final?','Who makes the final decision?',['No est√° claro','Not clear'],['Varios sin l√≠der','Multiple, no leader'],['El fundador','The founder'],['Direcci√≥n / Management','Management / Direction'],['Comit√© formal','Formal committee'],1.8],['PR ‚Äì Quick Profiling','Recruiter','¬øPresupuesto inicial (mkt/ventas/formaci√≥n)?','Initial budget (marketing/sales/training)?',['Sin presupuesto ($0)','No budget ($0)'],['Muy limitado (<$1k)','Very limited (<$1k)'],['$1,000 - $3,000','$1,000 - $3,000'],['$3,000 - $5,000','$3,000 - $5,000'],['>$5,000 planificado','>$5,000 planned'],1.8],['PR ‚Äì Quick Profiling','Recruiter','¬øCu√°ndo esperan cerrar primera venta Enterprise?','When do they expect first Enterprise sale?',['M√°s de 12 meses','>12 months'],['9-12 meses','9-12 months'],['6-9 meses','6-9 months'],['3-6 meses','3-6 months'],['Menos de 3 meses','<3 months'],1.8],['PR ‚Äì Quick Profiling','Recruiter','¬øAbiertos a reuni√≥n con PM (30-60-90)?','Open to PM meeting (30-60-90)?',['No est√°n interesados','Not interested'],['Prefieren esperar','Prefer to wait'],['Tal vez m√°s adelante','Maybe later'],['Probablemente s√≠','Probably yes'],['Definitivamente s√≠','Definitely yes'],1.8],['PR ‚Äì Quick Profiling','Recruiter','¬øEnd-customer o venden Community?','End-customer or sell Community?',['Solo uso interno','Internal use only'],['Principalmente Community','Mainly Community'],['Mix Community-Enterprise','Mix Community-Enterprise'],['Principalmente Enterprise','Mainly Enterprise'],['Solo Enterprise','Enterprise only'],1.8],['Estructura & Equipo','Ambos','¬øPersonas 100% dedicadas a Odoo?','People 100% dedicated to Odoo?',['Ninguna (0)','None (0)'],['1-2 personas','1-2 people'],['3-4 personas','3-4 people'],['5-7 personas','5-7 people'],['8+ personas','8+ people'],7.5],['Estructura & Equipo','Ambos','¬øFundador/CEO full-time en Odoo?','Founder/CEO full-time on Odoo?',['No, ausente','No, absent'],['Menos del 25%','Less than 25%'],['Parcial (50%)','Partial (50%)'],['Mayormente (75%+)','Mostly (75%+)'],['S√≠, 100%','Yes, 100%'],7.5],['Comerciales','PM','¬øPipeline activo Enterprise?','Active Enterprise pipeline?',['Ninguno','None'],['1-2 oportunidades','1-2 opportunities'],['3-5 oportunidades','3-5 opportunities'],['6-10 oportunidades','6-10 opportunities'],['10+ oportunidades','10+ opportunities'],4.5],['Comerciales','PM','¬øWin rate √∫ltimos 12 meses?','Win rate last 12 months?',['<10% o sin datos','<10% or no data'],['10-25%','10-25%'],['25-40%','25-40%'],['40-60%','40-60%'],['>60%','>60%'],4.5],['Comerciales','PM','¬øEquipo de ventas formal?','Formal sales team?',['No, oportunista','No, opportunistic'],['Fundador hace ventas','Founder does sales'],['1 persona part-time','1 part-time person'],['1-2 dedicadas','1-2 dedicated'],['Equipo estructurado (3+)','Structured team (3+)'],4.5],['Comerciales','PM','¬øICP o vertical definido?','Defined ICP or vertical?',['No, cualquier cliente','No, any customer'],['Idea vaga de sector','Vague sector idea'],['Vertical parcial','Partially defined vertical'],['ICP documentado b√°sico','Basic documented ICP'],['ICP claro con casos','Clear ICP with use cases'],4.5],['T√©cnicas','PM','¬øConsultores certificados (3 versiones)?','Certified consultants (3 versions)?',['Ninguno','None'],['1 certificado','1 certified'],['2 certificados','2 certified'],['3 certificados','3 certified'],['4+ certificados','4+ certified'],5],['T√©cnicas','PM','¬øCobertura de m√≥dulos?','Module coverage?',['1 m√≥dulo b√°sico','1 basic module'],['2-3 m√≥dulos','2-3 modules'],['4-5 m√≥dulos','4-5 modules'],['6-8 m√≥dulos','6-8 modules'],['8+ expertos','8+ expert modules'],5],['T√©cnicas','PM','¬øUsan Odoo.sh y QA/DevOps?','Use Odoo.sh and QA/DevOps?',['No usan Odoo.sh','Don\'t use Odoo.sh'],['Odoo.sh b√°sico','Basic Odoo.sh, no QA'],['Odoo.sh + QA manual','Odoo.sh + manual QA'],['QA semi-automatizado','Semi-automated QA'],['DevOps completo','Full DevOps'],5],['Delivery & CS','PM','¬øMetodolog√≠a de implementaci√≥n?','Implementation methodology?',['Ad-hoc / sin proceso','Ad-hoc / no process'],['Proceso informal','Informal process'],['Semi-estructurado','Semi-structured'],['Metodolog√≠a documentada','Documented methodology'],['√Ågil formalizada','Formalized agile'],3.5],['Delivery & CS','PM','¬øTime-to-first-value promedio?','Average time-to-first-value?',['>6 meses','>6 months'],['4-6 meses','4-6 months'],['3-4 meses','3-4 months'],['2-3 meses','2-3 months'],['<2 meses','<2 months'],3.5],['Delivery & CS','PM','¬øMiden NPS/CSAT o casos de √©xito?','Measure NPS/CSAT or success stories?',['No miden nada','Don\'t measure anything'],['Feedback informal','Informal feedback'],['1-2 casos documentados','1-2 documented cases'],['NPS/CSAT b√°sico','Basic NPS/CSAT'],['Sistema formal','Formal system + public cases'],3.5],['Delivery & CS','PM','¬øPost-go-live (soporte/upsell)?','Post-go-live (support/upsell)?',['Reactivo / ninguno','Reactive / none'],['Soporte b√°sico','Basic support only'],['Soporte + seguimiento','Support + occasional follow-up'],['Soporte estructurado','Structured support'],['Proactivo con SLAs','Proactive with SLAs'],3.5],['Compromiso','PM','¬øParticipan en trainings/webinars/eventos?','Participate in trainings/webinars/events?',['Nunca','Never'],['Raramente (1-2/a√±o)','Rarely (1-2/year)'],['Ocasional (trimestral)','Occasional (quarterly)'],['Regular (mensual)','Regular (monthly)'],['Muy activo (semanal+)','Very active (weekly+)'],3],['Compromiso','PM','¬øCo-sell o co-marketing con Odoo?','Co-sell or co-marketing with Odoo?',['No, ninguno','No, none'],['Inter√©s expresado','Interest expressed'],['1 piloto realizado','1 pilot done'],['2-3 iniciativas','2-3 initiatives'],['Colaboraci√≥n continua','Continuous collaboration'],3],['Compromiso','PM','¬øQu√© esperan de Odoo?','What do they expect from Odoo?',['Leads gratis','Free leads / opportunistic'],['Descuentos','Discounts and commissions'],['Soporte t√©cnico','Technical support'],['Enablement y co-mkt','Enablement and co-marketing'],['Alianza estrat√©gica','Mutual strategic alliance'],3],['Clientes & Retenci√≥n','PM','¬øClientes Enterprise activos?','Active Enterprise customers?',['0 clientes','0 customers'],['1-2 clientes','1-2 customers'],['3-5 clientes','3-5 customers'],['6-10 clientes','6-10 customers'],['10+ clientes','10+ customers'],2.67],['Clientes & Retenci√≥n','PM','¬øRetention rate anual?','Annual retention rate?',['<70% o sin datos','<70% or no data'],['70-80%','70-80%'],['80-90%','80-90%'],['90-95%','90-95%'],['>95%','>95%'],2.67],['Clientes & Retenci√≥n','PM','¬øMigraciones Community‚ÜíEnterprise?','Migrations Community‚ÜíEnterprise?',['Ninguna','No migrations'],['1 migraci√≥n','1 migration'],['2-3 migraciones','2-3 migrations'],['4-5 migraciones','4-5 migrations'],['6+ recurrentes','6+ recurring'],2.67],['Riesgos & Alertas','Ambos','¬øDependen de 1-2 clientes (>50% revenue)?','Depend on 1-2 customers (>50% revenue)?',['S√≠, 80%+ en 1','Yes, 80%+ in 1'],['60-80% concentrado','60-80% concentrated'],['40-60% concentrado','40-60% concentrated'],['20-40% concentrado','20-40% concentrated'],['Diversificado (<20%)','Diversified (<20%)'],1],['Riesgos & Alertas','Ambos','¬øRotaci√≥n de talento (>15% anual)?','Talent turnover (>15% annual)?',['Muy alta (>30%)','Very high (>30%)'],['Alta (20-30%)','High (20-30%)'],['Media (10-20%)','Medium (10-20%)'],['Baja (5-10%)','Low (5-10%)'],['Muy baja (<5%)','Very low (<5%)'],1],['Riesgos & Alertas','Ambos','¬øTrabajan con Community o end-customer?','Work with Community or end-customer?',['100% Community/end-user','100% Community/end-user'],['80% Community','80% Community'],['50/50 Comm-Enterprise','50/50 Comm-Enterprise'],['80% Enterprise','80% Enterprise'],['100% Enterprise','100% Enterprise'],1]];

const ACTION_PLANS={'Strategic-Established':{es:['Mantener alineaci√≥n estrat√©gica cercana','Invitar a co-sell y casos de √©xito','Explorar expansi√≥n multi-pa√≠s/vertical','Priorizar en nuevos features'],en:['Maintain close strategic alignment','Invite to co-sell and success stories','Explore multi-country/vertical expansion','Prioritize in new features']},'Strategic-Transforming':{es:['Coaching PM dedicado (30-60-90)','Priorizar enablement y automatizaci√≥n','Soporte en generaci√≥n de leads','Revisi√≥n trimestral de KPIs'],en:['Dedicated PM coaching (30-60-90)','Prioritize enablement and automation','Lead generation support','Quarterly KPI review']},'Strategic-Flagship':{es:['Posicionar como referente regional','Programas de speakers y eventos','Participaci√≥n en beta features','Pilotos de innovaci√≥n vertical'],en:['Position as regional reference','Speaker programs and events','Beta features participation','Vertical innovation pilots']},'Growth-Vertical':{es:['Assets de marketing vertical','Campa√±as de co-marketing','Listing Odoo.com por vertical','Exposici√≥n en Partner Day'],en:['Vertical marketing assets','Co-marketing campaigns','Odoo.com vertical listing','Partner Day exposure']},'Growth-Expanding':{es:['Enablement estructurado (KPIs)','Soporte en Success Packs','Foco en certificaciones','Tracking de NPS'],en:['Structured enablement (KPIs)','Success Packs support','Focus on certifications','NPS tracking']},'Growth-Broad':{es:['Guiar a enfoque vertical/regional','Revisi√≥n de pipeline','Reuniones de objetivos','Plan de especializaci√≥n'],en:['Guide to vertical/regional focus','Pipeline review','Goal-setting meetings','Specialization plan']},'Active-Emerging':{es:['Onboarding guiado intensivo','Coaching de ventas','Milestones corto plazo','Revisi√≥n mensual'],en:['Intensive guided onboarding','Sales coaching','Short-term milestones','Monthly review']},'Active-Transactional':{es:['Evaluar intenci√≥n real','Transici√≥n a modelo estructurado','Plan de delivery escalable','Recalificaci√≥n si no mejora'],en:['Evaluate real intent','Transition to structured model','Scalable delivery plan','Requalification if no improvement']},'Active-AtRisk':{es:['Intervenci√≥n PM urgente','Health-check completo','Plan reactivaci√≥n 60 d√≠as','Reclasificar si no mejora'],en:['Urgent PM intervention','Complete health-check','60-day reactivation plan','Reclassify if no improvement']},'LowFit-EndUser':{es:['Cerrar como "End-customer"','Referir a Direct Sales','Contacto Odoo Success','Sin seguimiento comercial'],en:['Close as "End-customer"','Refer to Direct Sales','Contact Odoo Success','No commercial follow-up']},'LowFit-Community':{es:['Touchpoints educativos','Webinars Enterprise','Archivar tras 2 intentos','Monitoreo trimestral pasivo'],en:['Educational touchpoints','Enterprise webinars','Archive after 2 attempts','Passive quarterly monitoring']},'LowFit-Inactive':{es:['Campa√±a outreach final','Email automatizado','Flag Dormant si no responde','Remover de roster activo'],en:['Final outreach campaign','Automated email','Flag Dormant if no response','Remove from active roster']},'LowFit-Dormant':{es:['Nurturing campaigns','Revisi√≥n trimestral','Email novedades cada 6m','Lista para reengagement'],en:['Nurturing campaigns','Quarterly review','News email every 6m','Ready for reengagement']}};

let currentLang='es';

function renderForm(){
  const root=document.getElementById('formRoot');
  root.innerHTML='';
  const grouped={};
  QUESTIONS.forEach(q=>{const b=q[0];if(!grouped[b])grouped[b]=[];grouped[b].push(q);});
  Object.entries(grouped).forEach(([block,list])=>{
    const card=document.createElement('div');
    card.className='bg-white rounded-2xl shadow overflow-hidden';
    card.innerHTML=`<div class="bg-gradient-to-r from-[#714B67] to-[#8a5d7f] text-white p-3 font-semibold">${block}</div>`;
    const container=document.createElement('div');
    container.className='p-4 space-y-6';
    list.forEach((q,idx)=>{
      const qId=`q_${block.replace(/\s+/g,'_')}_${idx}`;
      const question=currentLang==='es'?q[2]:q[3];
      const qDiv=document.createElement('div');
      qDiv.className='border-b pb-4';
      qDiv.dataset.role=q[1];
      qDiv.dataset.weight=q[9];
      qDiv.dataset.block=block;
      qDiv.dataset.qid=qId;
      let opts='';
      for(let i=1;i<=5;i++){
        const optText=currentLang==='es'?q[3+i][0]:q[3+i][1];
        opts+=`<label class="flex items-start gap-3 p-2 rounded cursor-pointer radio-option"><input type="radio" name="${qId}" value="${i}" class="mt-1"/><span class="text-sm"><strong class="text-[#714B67]">${i}</strong> ‚Äî ${optText}</span></label>`;
      }
      qDiv.innerHTML=`<div class="mb-3"><div class="flex items-start gap-2 mb-2"><span class="inline-block px-2 py-1 text-xs rounded ${q[1]==='Recruiter'?'bg-blue-100 text-blue-800':q[1]==='PM'?'bg-purple-100 text-purple-800':'bg-green-100 text-green-800'}">${q[1]}</span><p class="font-medium text-gray-800 question-text">${question}</p></div></div><div class="space-y-2 ml-2">${opts}</div><div class="mt-3"><textarea id="comment_${qId}" rows="2" class="w-full border rounded px-3 py-2 text-sm focus:ring-2 focus:ring-[#714B67]" placeholder="${LANG[currentLang].commentsPlaceholder}"></textarea></div>`;
      container.appendChild(qDiv);
    });
    card.appendChild(container);
    root.appendChild(card);
  });
  document.querySelectorAll('input[type="radio"]').forEach(r=>r.addEventListener('change',recalculate));
}

function recalculate(){
  applyFilters();
  let totalScore=0,redFlags=0,answered=false;
  const blockScores={};
  document.querySelectorAll('#formRoot>div').forEach(card=>{
    const block=card.querySelector('div').textContent;
    let blockTotal=0,blockWeight=0;
    card.querySelectorAll('[data-qid]').forEach(qDiv=>{
      if(qDiv.classList.contains('hidden'))return;
      const weight=parseFloat(qDiv.dataset.weight);
      const selected=qDiv.querySelector('input[type="radio"]:checked');
      if(selected){
        answered=true;
        const value=parseInt(selected.value);
        totalScore+=(value*weight/100);
        blockTotal+=(value*weight/100);
        blockWeight+=weight;
        if(value<=2){redFlags++;qDiv.classList.add('red-flag');}else{qDiv.classList.remove('red-flag');}
      }
    });
    if(blockWeight>0)blockScores[block]=(blockTotal/blockWeight)*100;
  });
  let category='Low Fit',categoryClass='bg-red-500 text-white';
  if(totalScore>=4.3){category='Strategic';categoryClass='bg-green-500 text-white';}
  else if(totalScore>=3.6){category='Growth';categoryClass='bg-blue-500 text-white';}
  else if(totalScore>=2.9){category='Active';categoryClass='bg-yellow-500 text-white';}
  const subcategory=getSubcategory(totalScore,category,blockScores,redFlags);
  const subcatKey=category.replace(' ','')+'-'+subcategory.replace(/\s+/g,'').replace('/','');
  const badgeType=document.getElementById('badgeType');
  badgeType.className='badge px-2 py-0.5 rounded '+(answered?categoryClass:'bg-white/20');
  badgeType.textContent=answered?category:'‚Äî';
  document.getElementById('badgeScore').textContent=answered?totalScore.toFixed(2):'‚Äî';
  document.getElementById('badgeRF').textContent=redFlags;
  document.getElementById('footerScore').textContent=answered?totalScore.toFixed(2):'‚Äî';
  document.getElementById('footerType').textContent=answered?category:'‚Äî';
  document.getElementById('footerRF').textContent=redFlags;
  if(answered){
    document.getElementById('resultsSummary').classList.remove('hidden');
    document.getElementById('displayScore').textContent=totalScore.toFixed(2);
    document.getElementById('displayCategory').textContent=category;
    document.getElementById('displaySubcategory').textContent=subcategory;
    const actionList=document.getElementById('actionPlanList');
    actionList.innerHTML='';
    const actions=ACTION_PLANS[subcatKey]?ACTION_PLANS[subcatKey][currentLang]:[];
    actions.forEach(action=>{const li=document.createElement('li');li.textContent='‚Ä¢ '+action;actionList.appendChild(li);});
  }else{document.getElementById('resultsSummary').classList.add('hidden');}
}

function getSubcategory(totalScore,category,blockScores,redFlags){
  const estructura=blockScores['Estructura & Equipo']||0;
  const comercial=blockScores['Comerciales']||0;
  const compromiso=blockScores['Compromiso']||0;
  const clientes=blockScores['Clientes & Retenci√≥n']||0;
  if(category==='Strategic'){
    if(totalScore>=4.6&&compromiso>=90&&clientes>=90)return currentLang==='es'?'Flagship / Champion':'Flagship / Champion';
    if(estructura>=90&&clientes>=80&&redFlags===0)return currentLang==='es'?'Establecido':'Established';
    return currentLang==='es'?'En Transformaci√≥n':'Transforming';
  }
  if(category==='Growth'){
    if(comercial>=80)return currentLang==='es'?'Enfoque Vertical':'Vertical-Focused';
    if(estructura>=70&&comercial>=70)return currentLang==='es'?'En Expansi√≥n':'Expanding';
    return currentLang==='es'?'Base Amplia':'Broad-Based';
  }
  if(category==='Active'){
    if(totalScore>=3.3&&compromiso>=60)return currentLang==='es'?'Emergente':'Emerging';
    if(redFlags>=3||clientes<50)return currentLang==='es'?'En Riesgo':'At-Risk';
    return currentLang==='es'?'Transaccional':'Transactional';
  }
  const quickProf=blockScores['PR ‚Äì Quick Profiling']||0;
  const delivery=blockScores['Delivery & CS']||0;
  if(quickProf<40)return currentLang==='es'?'End-User':'End-User';
  if(delivery<40)return currentLang==='es'?'Enfoque Community':'Community-Focused';
  if(compromiso<30)return currentLang==='es'?'Inactivo':'Inactive';
  return currentLang==='es'?'Dormido':'Dormant';
}

function applyFilters(){
  const mode=document.getElementById('roleMode').value;
  const search=document.getElementById('searchBox').value.toLowerCase();
  document.querySelectorAll('[data-qid]').forEach(qDiv=>{
    const role=qDiv.dataset.role;
    const text=qDiv.querySelector('.question-text').textContent.toLowerCase();
    const roleOk=(mode==='all')||(mode==='Recruiter'&&(role==='Recruiter'||role==='Ambos'))||(mode==='PM'&&(role==='PM'||role==='Ambos'));
    const textOk=search===''||text.includes(search);
    qDiv.classList.toggle('hidden',!(roleOk&&textOk));
  });
}

function updateLanguage(){
  document.getElementById('langText').textContent=currentLang.toUpperCase();
  Object.keys(LANG[currentLang]).forEach(key=>{const el=document.getElementById(key);if(el)el.textContent=LANG[currentLang][key];});
  renderForm();
  applyFilters();
}

document.getElementById('langToggle').addEventListener('click',()=>{currentLang=currentLang==='es'?'en':'es';updateLanguage();});

document.getElementById('btnClear').addEventListener('click',()=>{
  if(!confirm(LANG[currentLang].confirmClear))return;
  document.querySelectorAll('input[type="radio"]').forEach(r=>r.checked=false);
  document.querySelectorAll('textarea').forEach(t=>t.value='');
  document.querySelectorAll('[data-qid]').forEach(d=>d.classList.remove('red-flag','hidden'));
  document.getElementById('partnerName').value='';
  document.getElementById('partnerManager').value='';
  document.getElementById('roleMode').value='all';
  document.getElementById('searchBox').value='';
  recalculate();
});

document.getElementById('btnPDF').addEventListener('click',()=>{
  const partner=document.getElementById('partnerName').value.trim();
  const pm=document.getElementById('partnerManager').value.trim();
  if(!partner||!pm){alert(LANG[currentLang].alertNoData);return;}
  const totalScore=document.getElementById('footerScore').textContent;
  const category=document.getElementById('footerType').textContent;
  const subcategory=document.getElementById('displaySubcategory').textContent;
  const redFlags=document.getElementById('footerRF').textContent;
  document.getElementById('pdfDate').textContent=new Date().toLocaleString(currentLang==='es'?'es-ES':'en-US');
  document.getElementById('pdfPartner').textContent=partner;
  document.getElementById('pdfPM').textContent=pm;
  document.getElementById('pdfScore').textContent=totalScore;
  document.getElementById('pdfType').textContent=category;
  document.getElementById('pdfSubcat').textContent=subcategory;
  document.getElementById('pdfRF').textContent=redFlags;
  const subcatKey=category.replace(' ','')+'-'+subcategory.replace(/\s+/g,'').replace('/','').replace('En','').replace('Enfoque','');
  const actions=ACTION_PLANS[subcatKey]?ACTION_PLANS[subcatKey][currentLang]:[];
  document.getElementById('pdfActionPlan').innerHTML=actions.map(a=>`<p>‚Ä¢ ${a}</p>`).join('');
  const tbody=document.getElementById('pdfBody');
  tbody.innerHTML='';
  let hasData=false;
  document.querySelectorAll('[data-qid]').forEach(qDiv=>{
    if(qDiv.classList.contains('hidden'))return;
    const selected=qDiv.querySelector('input[type="radio"]:checked');
    if(!selected)return;
    hasData=true;
    const block=qDiv.dataset.block;
    const role=qDiv.dataset.role;
    const question=qDiv.querySelector('.question-text').textContent;
    const weight=qDiv.dataset.weight;
    const value=selected.value;
    const comment=qDiv.querySelector('textarea').value||'';
    const row=document.createElement('tr');
    row.innerHTML=`<td class="p-2 border">${block}</td><td class="p-2 border">${role}</td><td class="p-2 border">${question}</td><td class="p-2 border">${weight}%</td><td class="p-2 border">${value}</td><td class="p-2 border">${comment}</td>`;
    if(parseInt(value)<=2)row.classList.add('red-flag');
    tbody.appendChild(row);
  });
  if(!hasData){alert(LANG[currentLang].alertNoResponses);return;}
  const opt={margin:10,filename:`Qualification_${partner.replace(/\s+/g,'_')}_${new Date().toISOString().split('T')[0]}.pdf`,html2canvas:{scale:2},jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}};
  const src=document.getElementById('pdfArea');
  src.classList.remove('hidden');
  html2pdf().set(opt).from(src).save().then(()=>src.classList.add('hidden'));
});

document.getElementById('btnXLSX').addEventListener('click',()=>{
  const partner=document.getElementById('partnerName').value.trim();
  const pm=document.getElementById('partnerManager').value.trim();
  if(!partner||!pm){alert(LANG[currentLang].alertNoData);return;}
  const totalScore=document.getElementById('footerScore').textContent;
  const category=document.getElementById('footerType').textContent;
  const subcategory=document.getElementById('displaySubcategory').textContent;
  const redFlags=document.getElementById('footerRF').textContent;
  const summary=[['Partner',partner],['Partner Manager',pm],['Total Score',totalScore],['Category',category],['Subcategory',subcategory],['Red Flags',redFlags],['Generated',new Date().toLocaleString(currentLang==='es'?'es-ES':'en-US')],['Language',currentLang.toUpperCase()]];
  const subcatKey=category.replace(' ','')+'-'+subcategory.replace(/\s+/g,'').replace('/','').replace('En','').replace('Enfoque','');
  const actions=ACTION_PLANS[subcatKey]?ACTION_PLANS[subcatKey][currentLang]:[];
  summary.push([''],['Action Plan:']);
  actions.forEach(a=>summary.push(['',a]));
  const wsSummary=XLSX.utils.aoa_to_sheet(summary);
  const headers=['Block','Role','Question','Weight','Score','Comments'];
  const rows=[headers];
  let hasData=false;
  document.querySelectorAll('[data-qid]').forEach(qDiv=>{
    if(qDiv.classList.contains('hidden'))return;
    const selected=qDiv.querySelector('input[type="radio"]:checked');
    if(!selected)return;
    hasData=true;
    rows.push([qDiv.dataset.block,qDiv.dataset.role,qDiv.querySelector('.question-text').textContent,qDiv.dataset.weight+'%',selected.value,qDiv.querySelector('textarea').value||'']);
  });
  if(!hasData){alert(LANG[currentLang].alertNoResponses);return;}
  const wsResponses=XLSX.utils.aoa_to_sheet(rows);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,wsSummary,'Summary');
  XLSX.utils.book_append_sheet(wb,wsResponses,'Responses');
  XLSX.writeFile(wb,`Qualification_${partner.replace(/\s+/g,'_')}_${new Date().toISOString().split('T')[0]}.xlsx`);
});

document.getElementById('roleMode').addEventListener('change',applyFilters);
document.getElementById('searchBox').addEventListener('input',applyFilters);

updateLanguage();
recalculate();
  </script>
</body>
</html>
